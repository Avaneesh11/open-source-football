---
title: "Defense and rest time: re-visited"
description: |
  A short description of the post.
author:
  - name: Ben Baldwin
    url: https://twitter.com/benbbaldwin
date: 08-25-2020
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_depth: 3
repository_url: "https://github.com/mrcaseb/open-source-football"
categories:
  - nflfastR
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE, 
  dpi = 300, 
  tidy = 'styler'
  )

library(tidyverse)
library(lubridate)
library(ggthemes)
drives <- readRDS('data.rds')
```

This revisits an old piece I [did for Football Outsiders](https://www.footballoutsiders.com/stat-analysis/2018/defense-and-rest-time). In the piece, I looked at the relationship between defensive rest time and defensive performance, finding no evidence of a relationship. However, I didn't have a direct measure of rest time, so I had to use plays and time of possession rather than actual clock time elapsed.

Do the results look similar when using actual time? Let's start out by looking at how the time a defense has spent on the field is related to how many plays they have spent on the field (note: throughout, I'm excluding games with lightening or other delays because they mess with all these figures).

```{r, echo = FALSE, layout="l-body-outset", fig.height=4, preview=TRUE}
drives %>%
  mutate(cum_time_on_field = cum_time_on_field * 60) %>%
  ggplot(aes(cum_plays_on_field, cum_time_on_field)) +
  geom_point(alpha = .1, size = 1) +
  theme_stata(scheme = "sj", base_size = 12) +
  xlab("Total plays") +
  ylab("Total hours") +
  labs(x = "Total plays",
       y = "Total minutes",
       caption = "Figure: @benbbaldwin | Data: @nflfastR",
       title = 'Defense time spend on field') +
  theme(
    plot.title = element_text(face = 'bold'),
    plot.caption = element_text(hjust = 1),
    axis.text.y = element_text(angle = 0, vjust = 0.5),
    aspect.ratio = 1/1.618
  ) + 
  geom_smooth()
```

Pretty similar. So an initial finding is that we probably haven't been missing much by just measuring plays rather than actual time.

We can see something similar looking at actual rest time since the defense was last on the field:

```{r, echo = FALSE, layout="l-body-outset", fig.height=4}
drives %>%
  mutate(rest = rest * 60) %>%
  ggplot(aes(rest_plays, rest)) +
  geom_point(alpha = .1, size = 1) +
  theme_stata(scheme = "sj", base_size = 12) +
  labs(x = "Plays spent off field",
       y = "Time spent off field (minutes)",
       caption = "Figure: @benbbaldwin | Data: @nflfastR",
       title = 'Plays in previous drive vs rest') +
  theme(
    plot.title = element_text(face = 'bold'),
    plot.caption = element_text(hjust = 1),
    axis.text.y = element_text(angle = 0, vjust = 0.5),
    aspect.ratio = 1/1.618
  ) + 
  geom_smooth()
```

If you're wondering about the 1-play rest periods, those are primarily end-of-half situations where the defense is on the field for the last drive of the first half and first drive of the second half (and gets one play of rest as the kickoff). There are also some, for example, turnovers on special teams plays like fumbled kickoff returns where the defense doesn't rest for any "normal" play and has to go right back on the field.

We can also see this by field position versus time spent resting, where low rest time is associated with bad field position from the perspective of the defense:

```{r, echo = FALSE, layout="l-body-outset", fig.height=4}
# rest vs field position
drives %>%
  mutate(rest = rest * 60) %>%
  ggplot(aes(rest, yardline_100)) +
  geom_point(alpha = .1, size = 1) +
  theme_stata(scheme = "sj", base_size = 12) +
  labs(x = "Rest time (minutes)",
       y = "Distance from end zone",
       caption = "Figure: @benbbaldwin | Data: @nflfastR",
       title = 'Rest time vs field position') +
  theme(
    plot.title = element_text(face = 'bold'),
    plot.caption = element_text(hjust = 1),
    axis.text.y = element_text(angle = 0, vjust = 0.5),
    aspect.ratio = 1/1.618
  ) +
  geom_smooth()
```

This means that, as in the original piece, it's important to separate out field position effects from rest time effects.

Here's the distribution of defensive rest time. Most defenses get around 5-20 minutes of rest.

```{r, echo = FALSE, layout="l-body-outset", fig.height=4}
drives %>%
  filter(!is.na(rest), rest < 40 / 60) %>%
  mutate(
    rest = rest * 60
  ) %>%
  ggplot(aes(rest)) +
  geom_histogram(binwidth = 1, color="darkblue", fill="lightblue") +
  theme_stata(scheme = "sj", base_size = 12) +
labs(x = "Defense rest time",
     y = "Number of drives",
     caption = "Figure: @benbbaldwin | Data: @nflfastR",
     title = 'Distribution of defensive rest time') +
  theme(
    plot.title = element_text(face = 'bold'),
    plot.caption = element_text(hjust = 1),
    axis.text.y = element_text(angle = 0, vjust = 0.5),
    aspect.ratio = 1/1.618
  )
```


